<div class="flex items-center space-x-1">
  <ng-container *ngFor="let action of primaryActions">
    <ng-container *hasPermission="action.permission">
      <button
        *ngIf="isActionVisible(action)"
        [disabled]="isActionDisabled(action)"
        (click)="executeAction(action, $event)"
        [title]="action.label"
        class="inline-flex items-center justify-center w-8 h-8 rounded-md border border-gray-300 dark:border-gray-600 bg-[#ffffff] hover:bg-gray-300 dark:hover:bg-white/90 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        [ngClass]="{
          'text-gray-700 dark:text-gray-200':
            !isActionDisabled(action) && action.type !== 'danger',
          'text-red-600 dark:text-red-400':
            !isActionDisabled(action) && action.type === 'danger',
          'text-green-600 dark:text-green-400':
            !isActionDisabled(action) && action.type === 'success',
          'text-blue-600 dark:text-blue-400':
            !isActionDisabled(action) && action.type === 'primary',
          'text-yellow-600 dark:text-yellow-400':
            !isActionDisabled(action) && action.type === 'warning',
          'border-red-300 dark:border-red-600 hover:bg-red-50 dark:hover:bg-red-900/20':
            action.type === 'danger' && !isActionDisabled(action),
          'border-green-300 dark:border-green-600 hover:bg-green-50 dark:hover:bg-green-900/20':
            action.type === 'success' && !isActionDisabled(action),
          'border-blue-300 dark:border-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20':
            action.type === 'primary' && !isActionDisabled(action),
          'border-yellow-300 dark:border-yellow-600 hover:bg-yellow-50 dark:hover:bg-yellow-900/20':
            action.type === 'warning' && !isActionDisabled(action)
        }"
      >
        <img
          *ngIf="action.icon"
          [src]="getIconSvg(action.icon)"
          class="w-4 h-4"
          [alt]="action.label"
        />
      </button>
    </ng-container>
  </ng-container>

  <!-- More actions dropdown -->
  <div *ngIf="secondaryActions.length > 0" class="relative inline-block">
    <button
      (click)="toggleDropdown($event)"
      class="dropdown-button inline-flex items-center relative justify-center w-8 h-8 rounded-md border border-gray-300 dark:border-gray-600 bg-[#ffffff] text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-300/30 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"
      [ngClass]="{ active: isDropdownOpen }"
      [attr.aria-expanded]="isDropdownOpen"
      [attr.aria-haspopup]="true"
      aria-label="More actions"
    >
      <svg
        class="w-4 h-4"
        fill="none"
        viewBox="0 0 24 24"
        stroke="black"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"
        />
      </svg>
    </button>

    <!-- Dropdown backdrop -->
    <div
      *ngIf="isDropdownOpen"
      class="fixed inset-0 z-40"
      (click)="closeDropdown()"
      aria-hidden="true"
    ></div>

    <!-- Dropdown menu -->
    <div
      *ngIf="isDropdownOpen"
      class="dropdown-menu absolute right-0 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-xl py-1 z-50 transform transition-all duration-200 ease-out"
      [ngClass]="{
        'top-full mt-1': dropdownPosition === 'bottom',
        'bottom-full mb-1': dropdownPosition === 'top'
      }"
      [@dropdownAnimation]
      role="menu"
      aria-orientation="vertical"
      aria-labelledby="dropdown-button"
    >
      <ng-container
        *ngFor="let action of secondaryActions; trackBy: trackByAction"
      >
        <ng-container *hasPermission="action.permission">
          <hr
            *ngIf="action.separator"
            class="border-gray-200 dark:border-gray-600 my-1"
            role="separator"
          />
          <button
            *ngIf="!action.separator && isActionVisible(action)"
            [disabled]="isActionDisabled(action)"
            (click)="executeAction(action, $event)"
            class="dropdown-item w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-200/30 disabled:opacity-50 disabled:cursor-not-allowed flex items-center transition-colors duration-150"
            [ngClass]="{
              'text-gray-700 dark:text-gray-200':
                !isActionDisabled(action) && action.type !== 'danger',
              'text-red-600 dark:text-red-400':
                !isActionDisabled(action) && action.type === 'danger',
              'text-green-600 dark:text-green-400':
                !isActionDisabled(action) && action.type === 'success',
              'text-blue-600 dark:text-blue-400':
                !isActionDisabled(action) && action.type === 'primary',
              'text-yellow-600 dark:text-yellow-400':
                !isActionDisabled(action) && action.type === 'warning'
            }"
            role="menuitem"
            [attr.aria-label]="action.label"
          >
            <div class="bg-[#ffffff] p-1 rounded-md mr-2">
              <img
              *ngIf="action.icon"
              [src]="getIconSvg(action.icon)"
              class="w-4 h-4"
              [alt]=""
              aria-hidden="true"
            />
            </div>
            <span>{{ action.label }}</span>
          </button>
        </ng-container>
      </ng-container>
    </div>
  </div>
</div>
