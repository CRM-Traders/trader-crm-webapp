<div class="bg-white dark:bg-gray-800 rounded-lg">
  <!-- Modal Header -->
  <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
      Hidden Withdrawal
    </h2>
    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
      Process a hidden withdrawal for <strong>{{ data.userFullName }}</strong>
    </p>
  </div>

  <!-- Modal Body -->
  <div class="px-6 py-4 max-h-[70vh] overflow-y-auto">
    <form (ngSubmit)="onSubmit()" class="space-y-6">
      <!-- Trading Account Selection -->
      <div>
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          Trading Account <span class="text-red-500">*</span>
        </label>
        <select
          [(ngModel)]="tradingAccountId"
          name="tradingAccountId"
          class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-orange-500 focus:border-transparent"
          [disabled]="loadingAccounts()"
          required
        >
          <option value="" disabled>Select a trading account</option>
          <option
            *ngFor="let account of tradingAccounts()"
            [value]="account.id"
          >
            {{ account.displayName }} ({{ account.accountNumber }})
          </option>
        </select>
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
          Select the account to withdraw from
        </p>
      </div>

      <!-- Currency Selection -->
      <div>
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          Currency <span class="text-red-500">*</span>
        </label>
        <!-- Currency Search -->

        <select
          [(ngModel)]="currency"
          name="currency"
          (ngModelChange)="onCurrencyChange()"
          class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-orange-500 focus:border-transparent"
          [disabled]="loadingCurrencies()"
          required
        >
          <option *ngFor="let curr of filteredCurrencies()" [value]="curr">
            {{ curr }}
          </option>
        </select>
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
          Select the currency to withdraw
        </p>

        <!-- Balance Information -->
        <div
          *ngIf="loadingBalance()"
          class="mt-2 text-sm text-gray-600 dark:text-gray-400"
        >
          <svg
            class="animate-spin h-4 w-4 inline-block mr-2"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
          Loading balance...
        </div>

        <div
          *ngIf="
            !loadingBalance() &&
            userBalance() &&
            userBalance().balances &&
            userBalance().balances.length > 0
          "
          class="mt-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600"
        >
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300"
              >Available Balance</span
            >
            <span
              class="text-sm font-semibold text-green-600 dark:text-green-400"
            >
              {{ formatAmount(userBalance().balances[0].totalAvailable) }}
              {{ currency() }}
            </span>
          </div>
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm text-gray-600 dark:text-gray-400"
              >Locked Balance</span
            >
            <span class="text-sm text-gray-700 dark:text-gray-300">
              {{ formatAmount(userBalance().balances[0].totalLocked) }}
              {{ currency() }}
            </span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-600 dark:text-gray-400"
              >Total Balance</span
            >
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">
              {{ formatAmount(userBalance().balances[0].totalBalance) }}
              {{ currency() }}
            </span>
          </div>
        </div>
      </div>

      <!-- Amount -->
      <div>
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          Withdrawal Amount <span class="text-red-500">*</span>
        </label>
        <input
          type="number"
          [(ngModel)]="amount"
          name="amount"
          class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-orange-500 focus:border-transparent"
          placeholder="Enter amount"
          step="0.00000001"
          min="0"
          (keydown)="preventInvalidNumberInput($event)"
          required
        />
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
          Amount must be greater than 0
        </p>
      </div>

      <!-- Note (optional) -->
      <div>
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          Note (Optional)
        </label>
        <textarea
          [(ngModel)]="note"
          name="note"
          class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-orange-500 focus:border-transparent"
          placeholder="Enter optional note"
          rows="3"
        ></textarea>
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
          Add any additional notes for this withdrawal
        </p>
      </div>
    </form>
  </div>

  <!-- Modal Footer -->
  <div
    class="px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3"
  >
    <button
      type="button"
      (click)="onCancel()"
      [disabled]="submitting()"
      class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"
    >
      Cancel
    </button>
    <button
      type="button"
      (click)="onSubmit()"
      [disabled]="
        submitting() ||
        !tradingAccountId() ||
        !currency() ||
        !amount() ||
        amount()! <= 0
      "
      class="px-4 py-2 border border-transparent rounded-md text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center"
    >
      <svg
        *ngIf="submitting()"
        class="animate-spin -ml-1 mr-2 h-4 w-4 text-white"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
        ></circle>
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
        ></path>
      </svg>
      {{ submitting() ? "Processing..." : "Process Withdrawal" }}
    </button>
  </div>
</div>
