<div class="hierarchy-node">
    <!-- Node Header -->
    <div [class]="getNodeClasses()" (click)="onNodeClick()" [style.padding-left.rem]="node.level * 1.5"
        class="flex items-center py-2 px-3 rounded-lg cursor-pointer transition-all duration-200 group relative">
        <!-- Expand/Collapse Button -->
        <button *ngIf="node.hasChildren" (click)="onToggleClick($event)"
            class="!mr-2 p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-600/20 transition-colors">
            <svg class="w-4 h-4 transition-transform duration-200" [class.rotate-90]="isExpanded" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
        </button>

        <!-- Spacer for nodes without children -->
        <div *ngIf="!node.hasChildren" class="w-6 mr-2"></div>

        <!-- Node Icon -->
        <div [class]="getIconClasses()">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <!-- Brand Icon -->
                <path *ngIf="node.type === 'brand'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4">
                </path>
                <!-- Office Icon -->
                <path *ngIf="node.type === 'office'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 21h18M3 10h18M12 2l7 4v14a1 1 0 01-1 1H6a1 1 0 01-1-1V6l7-4zM12 6v4m0 4v4"></path>
                <!-- Desk Icon -->
                <path *ngIf="node.type === 'desk'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                </path>
                <!-- Team Icon -->
                <path *ngIf="node.type === 'team'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z">
                </path>
                <!-- Member Icon -->
                <path *ngIf="node.type === 'member'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
        </div>

        <!-- Node Content -->
        <div class="flex-1 min-w-0">
            <div class="flex items-center justify-between">
                <div class="flex items-center min-w-0">
                    <!-- Node Name -->
                    <span [class]="getNameClasses()" [innerHTML]="getHighlightedName()">
                    </span>

                    <span
                        class="text-xs ms-7 text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700/10 px-2 py-1 rounded-full">
                        {{ getChildrenCount() }}
                    </span>

                    <!-- Role Badge for Members -->
                    <span *ngIf="node.type === 'member' && node.data?.role"
                        class="ml-2 px-2 py-1 text-xs font-medium bg-blue-100/10 text-blue-800 dark:bg-blue-900/20 dark:text-blue-200 rounded-full">
                        {{ getRoleDisplayName(node.data.role) }}
                    </span>
                </div>

                <!-- Status Badge -->
                <span *ngIf="node.type !== 'member'" [class]="getStatusBadgeClasses()">
                    {{ node.isActive ? 'Active' : 'Inactive' }}
                </span>
            </div>

            <!-- Secondary Info -->
            <div *ngIf="getSecondaryInfo()" class="text-xs text-gray-500 dark:text-gray-400 mt-1 truncate">
                {{ getSecondaryInfo() }}
            </div>
        </div>

        <!-- Node Actions -->
        <!-- <div class="ml-2 opacity-0 group-hover:opacity-100 transition-opacity">
            <button class="p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded transition-colors"
                title="More options">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z">
                    </path>
                </svg>
            </button>
        </div> -->
    </div>

    <!-- Children -->
    <div *ngIf="node.hasChildren && isExpanded" class="children-container transition-all duration-300 ease-in-out">
        <ng-container *ngFor="let child of node.children">
            <app-hierarchy-node [node]="child" [expandedNodes]="expandedNodes" [searchQuery]="searchQuery"
                (nodeToggle)="nodeToggle.emit($event)" (nodeSelect)="nodeSelect.emit($event)"></app-hierarchy-node>
        </ng-container>
    </div>
</div>